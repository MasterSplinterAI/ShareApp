"use strict";(()=>{var t={};t.id=356,t.ids=[356],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7632:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u});var o={};r.r(o),r.d(o,{POST:()=>l});var a=r(9303),i=r(8716),n=r(670),s=r(7070);let p="undefined"!=typeof global&&global.roomStorage||r(1859).roomStorage;async function l(t,{params:e}){try{let{pin:r}=await t.json();if(!r)return s.NextResponse.json({error:"PIN is required"},{status:400});let o=p.validateRoom(e.roomId,r);if(!o.isValid)return s.NextResponse.json({error:"Invalid room or PIN"},{status:401});let a=p.getRoom(e.roomId),i=p.getParticipantCount(e.roomId);return s.NextResponse.json({roomId:e.roomId,isHost:o.isHost,participantPin:o.participantPin,participantCount:i,createdAt:a?.createdAt})}catch(t){return console.error("Error validating room:",t),s.NextResponse.json({error:"Failed to validate room"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/rooms/[roomId]/validate/route",pathname:"/api/rooms/[roomId]/validate",filename:"route",bundlePath:"app/api/rooms/[roomId]/validate/route"},resolvedPagePath:"/Users/rhule/.cursor/worktrees/share-app/xJVlP/conference-app/app/api/rooms/[roomId]/validate/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:u,serverHooks:m}=d,h="/api/rooms/[roomId]/validate/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}},1859:t=>{let e={room:{maxParticipants:10,pinLength:6,ttl:864e5}};class r{constructor(){this.rooms=new Map,this.cleanupInterval=null,this.startCleanup()}generateRoomId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let r=0;r<8;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}generatePin(){return Math.floor(1e5+9e5*Math.random()).toString()}createRoom(){let t;let e=0;do if(t=this.generateRoomId(),++e>100)throw Error("Failed to generate unique room ID");while(this.rooms.has(t.toUpperCase()));let r=this.generatePin(),o=this.generatePin(),a={id:t,hostPin:r,participantPin:o,createdAt:Date.now(),lastActivity:Date.now(),participants:new Set};return this.rooms.set(t.toUpperCase(),a),console.log(`Created room ${t} with host PIN ${r} and participant PIN ${o}`),{roomId:t,hostPin:r,participantPin:o}}validateRoom(t,e){let r=this.rooms.get(t.toUpperCase());return r?(r.lastActivity=Date.now(),e===r.hostPin)?{isValid:!0,isHost:!0,participantPin:r.participantPin}:e===r.participantPin?{isValid:!0,isHost:!1,participantPin:r.participantPin}:{isValid:!1}:{isValid:!1}}getRoom(t){return this.rooms.get(t.toUpperCase())}addParticipant(t,e){let r=this.rooms.get(t.toUpperCase());return!!r&&(r.participants.add(e),r.lastActivity=Date.now(),console.log(`Added participant ${e} to room ${t}. Total: ${r.participants.size}`),!0)}removeParticipant(t,e){let r=this.rooms.get(t.toUpperCase());return!!r&&(r.participants.delete(e),r.lastActivity=Date.now(),console.log(`Removed participant ${e} from room ${t}. Remaining: ${r.participants.size}`),!0)}getParticipantCount(t){let e=this.rooms.get(t.toUpperCase());return e?e.participants.size:0}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4)}cleanup(){let t=Date.now(),r=e.room.ttl;for(let[e,o]of this.rooms.entries())t-o.lastActivity>r&&(console.log(`Cleaning up expired room ${e}`),this.rooms.delete(e))}stopCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}let o=new r;t.exports={roomStorage:o,RoomStorage:r}}};var e=require("../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),o=e.X(0,[948,972],()=>r(7632));module.exports=o})();