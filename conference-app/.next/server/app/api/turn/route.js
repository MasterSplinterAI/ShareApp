"use strict";(()=>{var e={};e.id=248,e.ids=[248],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},387:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>T,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v});var n={};t.r(n),t.d(n,{GET:()=>p});var s=t(9303),a=t(8716),o=t(670),i=t(7070);class c{constructor(e,r){this.cache=null,this.cacheExpiry=null,this.apiToken=e,this.turnTokenId=r}async generateCredentials(e=86400){let r=Date.now();if(this.cache&&this.cacheExpiry&&r<this.cacheExpiry)return console.log("✅ Using cached Cloudflare TURN credentials"),this.cache;console.log("\uD83D\uDD04 Generating new Cloudflare TURN credentials...");try{let t=await fetch(`https://rtc.live.cloudflare.com/v1/turn/keys/${this.turnTokenId}/credentials/generate-ice-servers`,{method:"POST",headers:{Authorization:`Bearer ${this.apiToken}`,"Content-Type":"application/json"},body:JSON.stringify({ttl:e})});if(!t.ok)throw Error(`Cloudflare API returned ${t.status}: ${await t.text()}`);let n=await t.json();if(n.iceServers&&n.iceServers.length>0){let t=n.iceServers.map(e=>({urls:e.urls,username:e.username,credential:e.credential}));return this.cache=t,this.cacheExpiry=r+(e-3600)*1e3,console.log("✅ Generated Cloudflare TURN credentials"),t}throw Error("Invalid response from Cloudflare API: no iceServers")}catch(e){throw console.error("⚠️ Failed to fetch Cloudflare TURN credentials:",e),e}}clearCache(){this.cache=null,this.cacheExpiry=null}}let l=null;var u=t(4068);async function p(e){try{let e=function(){if(!l){let e=process.env.CLOUDFLARE_TURN_API_TOKEN,r=process.env.CLOUDFLARE_TURN_TOKEN_ID;if(!e||!r)throw Error("Missing Cloudflare TURN credentials in environment variables");l=new c(e,r)}return l}(),r=await e.generateCredentials(),t=[...u.v.webrtc.iceServers,...r];return i.NextResponse.json({iceServers:t})}catch(e){return console.error("Error generating TURN credentials:",e),i.NextResponse.json({iceServers:u.v.webrtc.iceServers})}}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/turn/route",pathname:"/api/turn",filename:"route",bundlePath:"app/api/turn/route"},resolvedPagePath:"/Users/rhule/.cursor/worktrees/share-app/xJVlP/conference-app/app/api/turn/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:f}=d,g="/api/turn/route";function T(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},4068:(e,r,t)=>{t.d(r,{v:()=>n});let n={cloudflare:{turnApiToken:process.env.CLOUDFLARE_TURN_API_TOKEN||"",turnTokenId:process.env.CLOUDFLARE_TURN_TOKEN_ID||"59d87715faf308d4ea571375623ec7a3"},websocket:{url:"http://localhost:3001"},redis:{url:process.env.REDIS_URL},room:{maxParticipants:10,pinLength:6,ttl:864e5},webrtc:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},isDevelopment:!1}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[948,972],()=>t(387));module.exports=n})();