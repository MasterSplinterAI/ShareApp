"use strict";(()=>{var t={};t.id=356,t.ids=[356],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5839:(t,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var r={};o.r(r),o.d(r,{POST:()=>p});var a=o(9303),s=o(8716),i=o(670),n=o(7070),l=o(7372);async function p(t,{params:e}){try{let{pin:o}=await t.json();if(!o)return n.NextResponse.json({error:"PIN is required"},{status:400});let r=l.f.validateRoom(e.roomId,o);if(!r.isValid)return n.NextResponse.json({error:"Invalid room or PIN"},{status:401});let a=l.f.getRoom(e.roomId),s=l.f.getParticipantCount(e.roomId);return n.NextResponse.json({roomId:e.roomId,isHost:r.isHost,participantPin:r.participantPin,participantCount:s,createdAt:a?.createdAt})}catch(t){return console.error("Error validating room:",t),n.NextResponse.json({error:"Failed to validate room"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/rooms/[roomId]/validate/route",pathname:"/api/rooms/[roomId]/validate",filename:"route",bundlePath:"app/api/rooms/[roomId]/validate/route"},resolvedPagePath:"/Users/rhule/.cursor/worktrees/share-app/xJVlP/conference-app/app/api/rooms/[roomId]/validate/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:m}=d,h="/api/rooms/[roomId]/validate/route";function v(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},4068:(t,e,o)=>{o.d(e,{v:()=>r});let r={cloudflare:{turnApiToken:process.env.CLOUDFLARE_TURN_API_TOKEN||"",turnTokenId:process.env.CLOUDFLARE_TURN_TOKEN_ID||"59d87715faf308d4ea571375623ec7a3"},websocket:{url:"http://localhost:3001"},redis:{url:process.env.REDIS_URL},room:{maxParticipants:10,pinLength:6,ttl:864e5},webrtc:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},isDevelopment:!1}},7372:(t,e,o)=>{o.d(e,{f:()=>s});var r=o(4068);class a{constructor(){this.rooms=new Map,this.cleanupInterval=null,this.startCleanup()}generateRoomId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let o=0;o<8;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}generatePin(){return Math.floor(1e5+9e5*Math.random()).toString()}createRoom(){let t;do t=this.generateRoomId();while(this.rooms.has(t));let e=this.generatePin(),o=this.generatePin(),r={id:t,hostPin:e,participantPin:o,createdAt:Date.now(),lastActivity:Date.now(),participants:new Set};return this.rooms.set(t,r),{roomId:t,hostPin:e,participantPin:o}}validateRoom(t,e){let o=t.toUpperCase(),r=this.rooms.get(o);if(!r)return console.log(`Room not found: ${o}`),{isValid:!1,isHost:!1};r.lastActivity=Date.now();let a=e.trim();return a===r.hostPin?(console.log(`Host PIN validated for room ${o}`),{isValid:!0,isHost:!0,participantPin:r.participantPin}):a===r.participantPin?(console.log(`Participant PIN validated for room ${o}`),{isValid:!0,isHost:!1}):(console.log(`Invalid PIN for room ${o}: ${a}`),{isValid:!1,isHost:!1})}getRoom(t){return this.rooms.get(t.toUpperCase())}addParticipant(t,e){let o=this.rooms.get(t.toUpperCase());return!!o&&(o.participants.add(e),o.lastActivity=Date.now(),!0)}removeParticipant(t,e){let o=this.rooms.get(t.toUpperCase());return!!o&&(o.participants.delete(e),o.lastActivity=Date.now(),!0)}getParticipantCount(t){let e=this.rooms.get(t.toUpperCase());return e?e.participants.size:0}cleanup(){let t=Date.now(),e=r.v.room.ttl;this.rooms.forEach((o,r)=>{t-o.lastActivity>e&&(this.rooms.delete(r),console.log(`Cleaned up expired room: ${r}`))})}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},36e5)}stopCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}let s=new a}};var e=require("../../../../../webpack-runtime.js");e.C(t);var o=t=>e(e.s=t),r=e.X(0,[948,972],()=>o(5839));module.exports=r})();