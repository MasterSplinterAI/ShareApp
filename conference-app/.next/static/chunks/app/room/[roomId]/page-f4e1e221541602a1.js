(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{8339:function(e,t,n){Promise.resolve().then(n.bind(n,1824))},1824:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(7437),a=n(6463),o=n(2265),i=n(9099);class s{setupEventHandlers(){this.pc.ontrack=e=>{var t;console.log("Received track from ".concat(this.userId,":"),e.track.kind,e.track.label);let[n]=e.streams,r=e.track.label.toLowerCase(),a=n.id.toLowerCase(),o=(null===(t=e.transceiver.mid)||void 0===t?void 0:t.toLowerCase())||"",i=e.track.contentHint||"",s=n.getAudioTracks().length>0,c=n.getVideoTracks().length>0&&!s,l="video"===e.track.kind&&c,d=r.includes("screen")||r.includes("display")||r.includes("desktop")||a.includes("screen")||a.includes("display")||o.includes("screen")||"detail"===i||l&&"recvonly"===e.transceiver.direction;console.log("Track detection for ".concat(this.userId,": isScreenShare=").concat(d,", label=").concat(e.track.label,", contentHint=").concat(i,", streamId=").concat(n.id,", isVideoOnly=").concat(c,", direction=").concat(e.transceiver.direction)),this.events.onTrack(n,this.userId,d)},this.pc.onconnectionstatechange=()=>{console.log("Connection state for ".concat(this.userId,": ").concat(this.pc.connectionState)),this.events.onConnectionStateChange(this.pc.connectionState,this.userId)},this.pc.oniceconnectionstatechange=()=>{console.log("ICE state for ".concat(this.userId,": ").concat(this.pc.iceConnectionState))},this.pc.onnegotiationneeded=()=>{console.log("Negotiation needed for ".concat(this.userId," (signaling state: ").concat(this.pc.signalingState,")"))},this.pc.ondatachannel=e=>{var t,n;let r=e.channel;console.log("Data channel received from ".concat(this.userId,": ").concat(r.label)),null===(t=(n=this.events).onDataChannel)||void 0===t||t.call(n,r,this.userId)}}createDataChannel(){try{this.dataChannel=this.pc.createDataChannel("messages",{ordered:!0}),this.dataChannel.onopen=()=>{console.log("Data channel opened with ".concat(this.userId))},this.dataChannel.onclose=()=>{console.log("Data channel closed with ".concat(this.userId))}}catch(e){console.error("Error creating data channel with ".concat(this.userId,":"),e)}}async addLocalStream(e){this.localStream=e,e.getTracks().forEach(t=>{console.log("Adding ".concat(t.kind," track to peer ").concat(this.userId)),this.pc.addTrack(t,e)})}async addScreenStream(e){this.screenStream=e,e.getTracks().forEach(t=>{console.log("Adding screen ".concat(t.kind," track to peer ").concat(this.userId));try{"contentHint"in t&&(t.contentHint="detail")}catch(e){}let n=this.pc.addTransceiver(t,{direction:"sendonly",streams:[e]});n.mid&&console.log("Screen share transceiver mid: ".concat(n.mid))});try{let e=await this.createOffer();return console.log("Created offer for screen share to ".concat(this.userId)),e}catch(e){return console.error("Error creating offer for screen share:",e),null}}removeScreenStream(){this.screenStream&&(this.screenStream.getTracks().forEach(e=>{let t=this.pc.getSenders().find(t=>t.track===e);t&&(console.log("Removing screen track from peer ".concat(this.userId)),this.pc.removeTrack(t)),e.stop()}),this.screenStream=null)}async updateMediaTrack(e,t){let n=this.pc.getSenders().find(t=>t.track===e);n&&await n.replaceTrack(t)}async handleOffer(e){let t=this.makingOffer||"stable"!==this.pc.signalingState;return(this.ignoreOffer=!this.isPolite&&t,this.ignoreOffer)?(console.log("Ignoring offer from ".concat(this.userId," due to offer collision")),null):(await this.pc.setRemoteDescription(e),await this.pc.setLocalDescription(),await this.flushIceCandidateQueue(),this.pc.localDescription)}async handleAnswer(e){let t=this.pc.signalingState;if("have-local-offer"===t)await this.pc.setRemoteDescription(e),await this.flushIceCandidateQueue();else if("stable"===t){console.log("Answer from ".concat(this.userId," arrived after state became stable (already handled), ignoring gracefully"));return}else if("have-remote-offer"===t){console.log("Answer from ".concat(this.userId," arrived while handling their offer (state: ").concat(t,"), ignoring"));return}else{console.warn("Cannot set answer for ".concat(this.userId,": signaling state is ").concat(t,", expected 'have-local-offer'"));return}}async handleIceCandidate(e){if(!this.pc.remoteDescription){console.log("Queueing ICE candidate from ".concat(this.userId," (remote description not set yet)")),this.iceCandidateQueue.push(e);return}try{await this.pc.addIceCandidate(e)}catch(e){console.error("Error adding ICE candidate from ".concat(this.userId,":"),e)}}async flushIceCandidateQueue(){if(0!==this.iceCandidateQueue.length)for(console.log("Flushing ".concat(this.iceCandidateQueue.length," queued ICE candidates for ").concat(this.userId));this.iceCandidateQueue.length>0;){let e=this.iceCandidateQueue.shift();if(e)try{await this.pc.addIceCandidate(e)}catch(e){console.error("Error adding queued ICE candidate from ".concat(this.userId,":"),e)}}}getLocalDescription(){return this.pc.localDescription}async createOffer(){if("have-local-offer"===this.pc.signalingState)throw console.log("Cannot create offer for ".concat(this.userId,": already have local offer")),Error("Offer already pending");if("have-remote-offer"===this.pc.signalingState)throw console.log("Cannot create offer for ".concat(this.userId,": already have remote offer")),Error("Remote offer pending");let e=await this.pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});return await this.pc.setLocalDescription(e),e}getIceCandidates(){return[]}onIceCandidate(e){this.pc.onicecandidate=t=>{t.candidate&&e(t.candidate)}}sendDataMessage(e){this.dataChannel&&"open"===this.dataChannel.readyState&&this.dataChannel.send(e)}setAudioEnabled(e){var t;null===(t=this.localStream)||void 0===t||t.getAudioTracks().forEach(t=>{t.enabled=e})}setVideoEnabled(e){var t;null===(t=this.localStream)||void 0===t||t.getVideoTracks().forEach(t=>{t.enabled=e})}getStats(){return this.pc.getStats()}close(){var e,t,n;null===(e=this.dataChannel)||void 0===e||e.close(),null===(t=this.localStream)||void 0===t||t.getTracks().forEach(e=>e.stop()),null===(n=this.screenStream)||void 0===n||n.getTracks().forEach(e=>e.stop()),this.pc.close()}getConnectionState(){return this.pc.connectionState}constructor(e,t,n,r){this.localStream=null,this.screenStream=null,this.makingOffer=!1,this.ignoreOffer=!1,this.dataChannel=null,this.iceCandidateQueue=[],this.userId=e,this.isPolite=n,this.events=r,this.pc=new RTCPeerConnection({iceServers:t,iceCandidatePoolSize:10}),this.setupEventHandlers(),this.createDataChannel()}}var c=n(5040),l=n(357);let d={cloudflare:{turnApiToken:l.env.CLOUDFLARE_TURN_API_TOKEN||"",turnTokenId:l.env.CLOUDFLARE_TURN_TOKEN_ID||"59d87715faf308d4ea571375623ec7a3"},websocket:{url:window.location.origin,path:window.location.pathname.startsWith("/meet")?"/meet/socket.io/":"/socket.io/"},redis:{url:l.env.REDIS_URL},room:{maxParticipants:10,pinLength:6,ttl:864e5},webrtc:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},isDevelopment:!1};class h{generateUserId(){return"user_".concat(Math.random().toString(36).substr(2,9))}connect(e,t){return new Promise((n,r)=>{this.roomId=e,console.log("SignalingClient: Connecting to",d.websocket.url,"path:",d.websocket.path),this.socket=(0,c.io)(d.websocket.url,{path:d.websocket.path,transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),this.socket.on("connect",()=>{console.log("SignalingClient: Connected to signaling server"),this.socket.emit("join-room",{roomId:e,pin:t,userId:this.userId})}),this.socket.on("current-participants",e=>{let{participants:t}=e;console.log("SignalingClient: Current participants:",t),n(t)}),this.socket.on("room-error",e=>{let{error:t}=e;console.error("Room error:",t),r(Error(t))}),this.socket.on("connect_error",e=>{console.error("SignalingClient: Connection error:",e.message),r(e)}),setTimeout(()=>{var e;(null===(e=this.socket)||void 0===e?void 0:e.connected)||(console.error("SignalingClient: Connection timeout"),r(Error("Connection timeout - could not connect to signaling server")))},1e4),this.setupEventHandlers()})}setupEventHandlers(){this.socket&&(this.socket.on("user-joined",e=>{var t,n;let{userId:r}=e;console.log("User joined:",r),null===(t=(n=this.events).onUserJoined)||void 0===t||t.call(n,r)}),this.socket.on("user-left",e=>{var t,n;let{userId:r}=e;console.log("User left:",r),null===(t=(n=this.events).onUserLeft)||void 0===t||t.call(n,r)}),this.socket.on("offer",e=>{var t,n;console.log("Received offer from:",e.from),null===(t=(n=this.events).onOffer)||void 0===t||t.call(n,e)}),this.socket.on("answer",e=>{var t,n;console.log("Received answer from:",e.from),null===(t=(n=this.events).onAnswer)||void 0===t||t.call(n,e)}),this.socket.on("ice-candidate",e=>{var t,n;console.log("Received ICE candidate from:",e.from),null===(t=(n=this.events).onIceCandidate)||void 0===t||t.call(n,e)}),this.socket.on("media-state",e=>{var t,n;console.log("Media state update:",e),null===(t=(n=this.events).onMediaState)||void 0===t||t.call(n,e)}),this.socket.on("screen-share-started",e=>{var t,n;let{userId:r}=e;console.log("Screen share started by:",r),null===(t=(n=this.events).onScreenShareStarted)||void 0===t||t.call(n,r)}),this.socket.on("screen-share-stopped",e=>{var t,n;let{userId:r}=e;console.log("Screen share stopped by:",r),null===(t=(n=this.events).onScreenShareStopped)||void 0===t||t.call(n,r)}))}on(e,t){this.events[e]=t}sendOffer(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("offer",{offer:e,to:t})}sendAnswer(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("answer",{answer:e,to:t})}sendIceCandidate(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("ice-candidate",{candidate:e,to:t})}updateMediaState(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("media-state",{audio:e,video:t})}startScreenShare(){var e;null===(e=this.socket)||void 0===e||e.emit("screen-share-started")}stopScreenShare(){var e;null===(e=this.socket)||void 0===e||e.emit("screen-share-stopped")}disconnect(){this.socket&&(this.socket.emit("leave-room"),this.socket.disconnect(),this.socket=null)}getUserId(){return this.userId||""}getRoomId(){return this.roomId||""}constructor(){this.socket=null,this.roomId=null,this.userId=null,this.events={},this.userId=this.generateUserId()}}var u=n(4663);class m{setupSignalingHandlers(){this.signaling.on("onUserJoined",async e=>{await this.createPeerConnection(e,!0)}),this.signaling.on("onUserLeft",e=>{this.removePeerConnection(e)}),this.signaling.on("onOffer",async e=>{let{offer:t,from:n}=e,r=await this.getOrCreatePeerConnection(n,!1),a=await r.handleOffer(t);a&&this.signaling.sendAnswer(a,n)}),this.signaling.on("onAnswer",async e=>{let{answer:t,from:n}=e,r=this.peers.get(n);r&&await r.handleAnswer(t)}),this.signaling.on("onIceCandidate",async e=>{let{candidate:t,from:n}=e,r=this.peers.get(n);r&&await r.handleIceCandidate(t)}),this.signaling.on("onMediaState",e=>{let{userId:t,audio:n,video:r}=e;this.events.onMediaStateChange(t,n,r)}),this.signaling.on("onScreenShareStarted",e=>{console.log("User ".concat(e," started screen sharing"))}),this.signaling.on("onScreenShareStopped",e=>{console.log("User ".concat(e," stopped screen sharing"))})}async initialize(e,t){console.log("ConnectionManager: Starting initialization for room:",e);try{console.log("ConnectionManager: Fetching ICE servers...");let e=await fetch((0,u.k)("/api/turn")),t=await e.json();this.iceServers=t.iceServers,console.log("ConnectionManager: Got ICE servers:",this.iceServers.length)}catch(e){console.error("Failed to fetch ICE servers:",e),this.iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],console.log("ConnectionManager: Using default STUN servers")}console.log("ConnectionManager: Getting user media..."),await this.initializeLocalStream(),console.log("ConnectionManager: Connecting to signaling server...");let n=await this.signaling.connect(e,t);for(let e of(console.log("ConnectionManager: Connected, participants:",n),n))await this.createPeerConnection(e,!1)}async initializeLocalStream(){try{let e={video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}};try{this.localStream=await navigator.mediaDevices.getUserMedia(e)}catch(t){console.warn("Failed to get video, trying audio only:",t),e={video:!1,audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},this.localStream=await navigator.mediaDevices.getUserMedia(e)}this.events.onStreamAdded(this.localStream,"local",!1)}catch(e){console.error("Failed to get user media:",e),this.localStream=new MediaStream,this.events.onStreamAdded(this.localStream,"local",!1)}}async createPeerConnection(e,t){let n=new s(e,this.iceServers,t,{onTrack:(e,t,n)=>{this.events.onStreamAdded(e,t,n)},onTrackRemoved:(e,t)=>{this.events.onStreamRemoved(e,t)},onConnectionStateChange:(e,t)=>{this.events.onPeerStateChange(t,e),("failed"===e||"closed"===e)&&this.removePeerConnection(t)}});if(this.peers.set(e,n),n.onIceCandidate(t=>{this.signaling.sendIceCandidate(t,e)}),this.localStream&&await n.addLocalStream(this.localStream),this.screenStream&&await n.addScreenStream(this.screenStream),t){await new Promise(e=>setTimeout(e,100));let t=n.getLocalDescription();if(t&&"offer"===t.type)console.log("Using existing offer for ".concat(e));else try{t=await n.createOffer(),console.log("Created and sending offer to ".concat(e))}catch(t){var r,a;if((null===(r=t.message)||void 0===r?void 0:r.includes("already"))||(null===(a=t.message)||void 0===a?void 0:a.includes("pending")))return console.log("Offer already pending for ".concat(e,", skipping")),n;return console.error("Error creating offer for ".concat(e,":"),t),n}t&&(this.signaling.sendOffer(t,e),console.log("Sent offer to ".concat(e)))}return n}async getOrCreatePeerConnection(e,t){let n=this.peers.get(e);return n||(n=await this.createPeerConnection(e,t)),n}removePeerConnection(e){let t=this.peers.get(e);t?(console.log("Removing peer connection for ".concat(e)),t.close(),this.peers.delete(e),this.events.onParticipantRemoved?(console.log("Calling onParticipantRemoved for ".concat(e)),this.events.onParticipantRemoved(e)):console.warn("onParticipantRemoved callback not set")):console.warn("No peer connection found for ".concat(e))}async startScreenShare(){try{this.screenStream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}),this.screenStream.getVideoTracks().forEach(e=>{try{"contentHint"in e&&(e.contentHint="detail")}catch(e){console.log("Could not set contentHint (read-only):",e)}}),this.peers.forEach(async(e,t)=>{let n=await e.addScreenStream(this.screenStream);n&&(console.log("Sending screen share offer to ".concat(t)),this.signaling.sendOffer(n,t))}),this.screenStream.getVideoTracks()[0].onended=()=>{this.stopScreenShare()},this.signaling.startScreenShare(),this.events.onStreamAdded(this.screenStream,"local",!0)}catch(e){throw console.error("Failed to start screen share:",e),e}}stopScreenShare(){this.screenStream&&(this.peers.forEach((e,t)=>{e.removeScreenStream()}),this.screenStream.getTracks().forEach(e=>e.stop()),this.events.onStreamRemoved(this.screenStream.id,"local"),this.screenStream=null,this.signaling.stopScreenShare())}setAudioEnabled(e){var t;this.mediaState.audio=e,null===(t=this.localStream)||void 0===t||t.getAudioTracks().forEach(t=>{t.enabled=e}),this.peers.forEach((t,n)=>{t.setAudioEnabled(e)}),this.signaling.updateMediaState(e,this.mediaState.video)}setVideoEnabled(e){var t;this.mediaState.video=e,null===(t=this.localStream)||void 0===t||t.getVideoTracks().forEach(t=>{t.enabled=e}),this.peers.forEach((t,n)=>{t.setVideoEnabled(e)}),this.signaling.updateMediaState(this.mediaState.audio,e)}async switchCamera(){if(!this.localStream)return;let e=this.localStream.getVideoTracks()[0];if(!e)return;let t=e.getConstraints().facingMode||"user";try{let n=(await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"===t?"environment":"user"},audio:!1})).getVideoTracks()[0];this.localStream.removeTrack(e),this.localStream.addTrack(n),e.stop(),this.peers.forEach(async(t,r)=>{await t.updateMediaTrack(e,n)})}catch(e){console.error("Failed to switch camera:",e)}}disconnect(){var e,t;null===(e=this.localStream)||void 0===e||e.getTracks().forEach(e=>e.stop()),null===(t=this.screenStream)||void 0===t||t.getTracks().forEach(e=>e.stop()),this.peers.forEach((e,t)=>{e.close()}),this.peers.clear(),this.signaling.disconnect()}getMediaState(){return{...this.mediaState}}isScreenSharing(){return null!==this.screenStream}constructor(e){this.peers=new Map,this.localStream=null,this.screenStream=null,this.iceServers=[],this.mediaState={audio:!0,video:!0},this.signaling=new h,this.events=e,this.setupSignalingHandlers()}}let g=(0,i.Ue)((e,t)=>({roomId:null,isHost:!1,participants:new Map,localParticipant:null,isAudioEnabled:!0,isVideoEnabled:!0,isScreenSharing:!1,connectionManager:null,isConnecting:!1,isConnected:!1,error:null,initialize:async(n,r,a)=>{let{connectionManager:o}=t();if(o){console.warn("Conference already initialized");return}console.log("Initializing conference for room:",n,"isHost:",a),e({isConnecting:!0,error:null,roomId:n,isHost:a});try{let a=new m({onStreamAdded:(e,n,r)=>{t().addParticipant(n,e,r)},onStreamRemoved:(n,r)=>{var a,o,i,s;let{participants:c,localParticipant:l}=t();if(console.log("[Store] onStreamRemoved: streamId=".concat(n,", userId=").concat(r)),"local"===r&&l)(null===(a=l.screenStream)||void 0===a?void 0:a.id)===n?(console.log("[Store] Removing local screen share stream: ".concat(n)),e({localParticipant:{...l,screenStream:void 0}}),e({isScreenSharing:!1})):(null===(o=l.stream)||void 0===o?void 0:o.id)===n&&console.log("[Store] WARNING: Attempted to remove local video stream, preserving it");else{let t=c.get(r);t&&((null===(i=t.screenStream)||void 0===i?void 0:i.id)===n?(console.log("[Store] Removing remote screen share for ".concat(r)),t.screenStream=void 0):(null===(s=t.stream)||void 0===s?void 0:s.id)===n&&(console.log("[Store] Removing remote video stream for ".concat(r)),t.stream=void 0),e({participants:new Map(c)}))}},onParticipantRemoved:e=>{console.log("[Store] Removing participant ".concat(e," from store"));let{localParticipant:n}=t();if("local"===e){console.warn("[Store] Attempted to remove local participant, ignoring");return}t().removeParticipant(e);let{localParticipant:r}=t();r&&r.stream?console.log("[Store] Local participant stream intact after removal"):console.error("[Store] ERROR: Local participant stream was cleared!")},onPeerStateChange:(e,n)=>{t().updateParticipantConnection(e,n)},onMediaStateChange:(e,n,r)=>{t().updateParticipantMedia(e,n,r)}});await a.initialize(n,r),console.log("ConferenceStore: Initialization successful"),e({connectionManager:a,isConnecting:!1,isConnected:!0})}catch(t){console.error("ConferenceStore: Initialization failed:",t),e({isConnecting:!1,isConnected:!1,error:t.message||"Failed to connect to conference"})}},toggleAudio:()=>{let{connectionManager:n,isAudioEnabled:r}=t();if(!n)return;let a=!r;n.setAudioEnabled(a),e({isAudioEnabled:a});let{localParticipant:o}=t();o&&e({localParticipant:{...o,audioEnabled:a,stream:o.stream,screenStream:o.screenStream}})},toggleVideo:()=>{let{connectionManager:n,isVideoEnabled:r}=t();if(!n)return;let a=!r;n.setVideoEnabled(a),e({isVideoEnabled:a});let{localParticipant:o}=t();o&&e({localParticipant:{...o,videoEnabled:a,stream:o.stream,screenStream:o.screenStream}})},toggleScreenShare:async()=>{let{connectionManager:n,isScreenSharing:r}=t();if(n)try{if(r){console.log("[Store] Stopping screen share"),n.stopScreenShare(),e({isScreenSharing:!1});let{localParticipant:r}=t();(null==r?void 0:r.screenStream)&&e({localParticipant:{...r,screenStream:void 0}})}else await n.startScreenShare(),e({isScreenSharing:!0})}catch(e){console.error("Failed to toggle screen share:",e)}},switchCamera:async()=>{let{connectionManager:e}=t();if(e)try{await e.switchCamera()}catch(e){console.error("Failed to switch camera:",e)}},disconnect:()=>{let{connectionManager:n}=t();n&&n.disconnect(),e({roomId:null,isHost:!1,participants:new Map,localParticipant:null,isAudioEnabled:!0,isVideoEnabled:!0,isScreenSharing:!1,connectionManager:null,isConnecting:!1,isConnected:!1,error:null})},addParticipant:function(n,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{participants:o,localParticipant:i}=t();if("local"===n){let t=i||{id:"local",audioEnabled:!0,videoEnabled:!0,connectionState:"connected"},n={...t};a?n.screenStream=r:r?(n.stream=r,console.log("[Store] Setting local stream:",r.id,"tracks:",r.getTracks().length)):n.stream=t.stream,e({localParticipant:n})}else{let t=o.get(n);t||(t={id:n,audioEnabled:!0,videoEnabled:!0,connectionState:"connecting"}),a?t.screenStream=r:t.stream=r,o.set(n,t),e({participants:new Map(o)})}},removeParticipant:n=>{console.log("[Store] removeParticipant called for ".concat(n));let{participants:r,localParticipant:a}=t();if("local"===n){console.warn("[Store] Attempted to remove local participant, ignoring");return}let o=new Map;r.forEach((e,t)=>{t!==n&&o.set(t,e)}),console.log("[Store] Participant ".concat(n," removed. Remaining participants: ").concat(o.size)),console.log("[Store] Local participant exists: ".concat(!!a,", has stream: ").concat(!!(null==a?void 0:a.stream))),a&&a.stream||console.error("[Store] CRITICAL: Local participant missing or has no stream before removal!"),e({participants:o,localParticipant:a?{...a,stream:a.stream,screenStream:a.screenStream}:null});let{localParticipant:i}=t();i&&i.stream?console.log("[Store] Local participant preserved: has stream=".concat(!!i.stream,", has screenStream=").concat(!!i.screenStream)):console.error("[Store] CRITICAL: Local participant stream was lost after removal!")},updateParticipantMedia:(n,r,a)=>{let{participants:o}=t(),i=o.get(n);i&&(i.audioEnabled=r,i.videoEnabled=a,e({participants:new Map(o)}))},updateParticipantConnection:(n,r)=>{let{participants:a}=t(),o=a.get(n);o&&(o.connectionState=r,e({participants:new Map(a)}))}}));function p(e){let{participant:t,stream:n,isLocal:a,isScreenShare:i,isFocused:s}=e,c=(0,o.useRef)(null),[l,d]=(0,o.useState)(!1),[h,u]=(0,o.useState)(!1),[m,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(c.current){if(n){let e=c.current.srcObject;(a?e===n&&e:e===n)||(console.log("[VideoTile] ".concat(a?"LOCAL":"REMOTE"," Setting stream for ").concat(a?"local":t.id,":"),n.id,"tracks:",n.getTracks().length),c.current.srcObject=n,a&&(c.current.muted=!0),c.current.play().catch(e=>{console.warn("[VideoTile] Could not autoplay video:",e)}));let r=n.getVideoTracks(),o=r.length>0&&r[0].enabled&&"live"===r[0].readyState;d(o),o&&c.current&&0===c.current.readyState&&(console.log("[VideoTile] Video element not ready, forcing reload for ".concat(a?"local":t.id)),c.current.load(),c.current.play().catch(e=>{console.warn("[VideoTile] Could not play after reload:",e)}))}else c.current.srcObject=null,d(!1);if(n){let e=()=>{let e=n.getVideoTracks(),t=e.length>0&&e[0].enabled&&"live"===e[0].readyState;d(t),t&&c.current&&c.current.play().catch(e=>{console.warn("[VideoTile] Could not play after track change:",e)})},r=()=>{console.log("[VideoTile] Track ended for ".concat(a?"local":t.id)),d(!1)};return n.addEventListener("addtrack",e),n.addEventListener("removetrack",e),n.getVideoTracks().forEach(e=>{e.addEventListener("ended",r)}),()=>{n.removeEventListener("addtrack",e),n.removeEventListener("removetrack",e),n.getVideoTracks().forEach(e=>{e.removeEventListener("ended",r)})}}}},[n,a,t.id]),(0,o.useEffect)(()=>{if(!i&&void 0!==t.videoEnabled&&(d(t.videoEnabled),t.videoEnabled&&c.current&&n)){let e=n.getVideoTracks();e.length>0&&"live"===e[0].readyState&&(c.current.srcObject!==n&&(console.log("[VideoTile] Restoring stream after video enabled for ".concat(a?"local":t.id)),c.current.srcObject=n),c.current.play().catch(e=>{console.warn("[VideoTile] Could not play after enabling video:",e)}))}},[t.videoEnabled,i,n,a,t.id]);let p=async()=>{if(c.current)try{document.pictureInPictureElement===c.current?(await document.exitPictureInPicture(),u(!1)):document.pictureInPictureEnabled&&(await c.current.requestPictureInPicture(),u(!0))}catch(e){console.error("PiP error:",e)}},v=async()=>{if(!c.current)return;let e=c.current,t=e.parentElement,n=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);try{if(n)document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen(),g(!1);else{let n=/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!window.MSStream,r=window.innerWidth<=768||/Mobi|Android/i.test(navigator.userAgent);n&&e.webkitEnterFullscreen?(e.webkitEnterFullscreen(),g(!0)):r&&t?(t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.zIndex="9999",t.style.backgroundColor="#000"),g(!0)):(null==t?void 0:t.requestFullscreen)?(await t.requestFullscreen(),g(!0)):(null==t?void 0:t.webkitRequestFullscreen)?(await t.webkitRequestFullscreen(),g(!0)):(null==t?void 0:t.mozRequestFullScreen)?(await t.mozRequestFullScreen(),g(!0)):(null==t?void 0:t.msRequestFullscreen)&&(await t.msRequestFullscreen(),g(!0))}}catch(e){console.error("Fullscreen error:",e),!n&&t&&(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.zIndex="9999",t.style.backgroundColor="#000",g(!0))}};return(0,o.useEffect)(()=>{if(!c.current)return;let e=()=>{g(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]),(0,o.useEffect)(()=>{let e=c.current;if(!e)return;let t=()=>u(!0),n=()=>u(!1);return e.addEventListener("enterpictureinpicture",t),e.addEventListener("leavepictureinpicture",n),()=>{e.removeEventListener("enterpictureinpicture",t),e.removeEventListener("leavepictureinpicture",n)}},[]),(0,r.jsxs)("div",{className:"\n        relative bg-gray-800 rounded-lg overflow-hidden\n        ".concat(s?"col-span-full row-span-full":"","\n        ").concat(i?"bg-gray-700":"","\n      "),children:[(0,r.jsx)("video",{ref:c,autoPlay:!0,playsInline:!0,muted:a,className:"\n          w-full h-full object-cover\n          ".concat(l?"":"hidden","\n          ").concat(a?"transform scale-x-[-1]":"","\n        ")}),!l&&!i&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800",children:(0,r.jsx)("div",{className:"w-24 h-24 bg-gray-700 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-12 h-12 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})}),!l&&i&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-700",children:(0,r.jsx)("svg",{className:"w-16 h-16 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/70 to-transparent",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("span",{className:"text-white text-sm font-medium truncate",children:[a?"You":t.id,i&&" (Screen)"]}),!t.audioEnabled&&!i&&(0,r.jsx)("svg",{className:"w-4 h-4 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),(()=>{switch(t.connectionState){case"connecting":return(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});case"connected":default:return null;case"failed":case"disconnected":return(0,r.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}})()]})}),l&&(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[!a&&(0,r.jsx)("button",{onClick:v,className:"\n                p-2 rounded-lg\n                ".concat(m?"bg-blue-600":"bg-black/50 hover:bg-black/70","\n                text-white transition-colors\n              "),title:m?"Exit Fullscreen":"Fullscreen",children:m?(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),!a&&document.pictureInPictureEnabled&&(0,r.jsx)("button",{onClick:p,className:"\n                p-2 rounded-lg\n                ".concat(h?"bg-blue-600":"bg-black/50 hover:bg-black/70","\n                text-white transition-colors\n              "),title:h?"Exit Picture-in-Picture":"Picture-in-Picture",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),s&&(0,r.jsx)("div",{className:"absolute top-2 left-2 p-1 bg-blue-600 rounded",children:(0,r.jsxs)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,r.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,r.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]})}function v(e){let{localParticipant:t,participants:n}=e,a=(0,o.useRef)(null),i=(()=>{let e=n.size+(t?1:0);return(null==t?void 0:t.screenStream)||Array.from(n.values()).some(e=>e.screenStream)?"screen-share":e<=1?"single":e<=2?"duo":e<=4?"quad":e<=6?"six":e<=9?"nine":"many"})(),s=(()=>{let e=[];return t&&(t.stream&&e.push({participant:t,isLocal:!0,isScreenShare:!1,stream:t.stream}),t.screenStream&&e.push({participant:t,isLocal:!0,isScreenShare:!0,stream:t.screenStream})),n.forEach(t=>{t.stream&&e.push({participant:t,isLocal:!1,isScreenShare:!1,stream:t.stream}),t.screenStream&&e.push({participant:t,isLocal:!1,isScreenShare:!0,stream:t.screenStream})}),e})(),c=s.filter(e=>e.isScreenShare),l=s.filter(e=>!e.isScreenShare);return(0,r.jsx)("div",{ref:a,className:"h-full w-full bg-gray-900 p-2",children:"screen-share"===i&&c.length>0?(0,r.jsxs)("div",{className:"h-full flex flex-col lg:flex-row gap-2",children:[(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)("div",{className:"h-full grid gap-2",children:c.map(e=>(0,r.jsx)(p,{participant:e.participant,stream:e.stream,isLocal:e.isLocal,isScreenShare:!0,isFocused:!0},"".concat(e.participant.id,"-screen")))})}),l.length>0&&(0,r.jsx)("div",{className:"h-32 lg:h-full lg:w-64 xl:w-80 overflow-y-auto",children:(0,r.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-1 gap-2",children:l.map(e=>(0,r.jsx)(p,{participant:e.participant,stream:e.stream,isLocal:e.isLocal,isScreenShare:!1,isFocused:!1},e.participant.id))})})]}):(0,r.jsx)("div",{className:"\n            h-full grid gap-2\n            ".concat("single"===i?"grid-cols-1":"","\n            ").concat("duo"===i?"grid-cols-1 md:grid-cols-2":"","\n            ").concat("quad"===i?"grid-cols-2":"","\n            ").concat("six"===i?"grid-cols-2 md:grid-cols-3":"","\n            ").concat("nine"===i?"grid-cols-3":"","\n            ").concat("many"===i?"grid-cols-3 md:grid-cols-4":"","\n          "),children:l.map(e=>(0,r.jsx)(p,{participant:e.participant,stream:e.stream,isLocal:e.isLocal,isScreenShare:!1,isFocused:"single"===i},e.participant.id))})})}function f(e){var t;let{onLeave:n}=e,{isAudioEnabled:a,isVideoEnabled:i,isScreenSharing:s,toggleAudio:c,toggleVideo:l,toggleScreenShare:d,switchCamera:h}=g(),[u,m]=(0,o.useState)(!1),[p,v]=(0,o.useState)(!1);return null===(t=navigator.mediaDevices)||void 0===t||t.enumerateDevices().then(e=>{v(e.filter(e=>"videoinput"===e.kind).length>1)}),(0,r.jsx)("div",{className:"bg-gray-800 border-t border-gray-700",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,r.jsx)("button",{onClick:c,className:"\n              p-3 rounded-full transition-colors\n              ".concat(a?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white","\n            "),title:a?"Mute":"Unmute",children:a?(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}):(0,r.jsxs)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z",clipRule:"evenodd"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),(0,r.jsx)("button",{onClick:l,className:"\n              p-3 rounded-full transition-colors\n              ".concat(i?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white","\n            "),title:i?"Stop Video":"Start Video",children:i?(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):(0,r.jsxs)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364L5.636 5.636"})]})}),(0,r.jsx)("button",{onClick:d,className:"\n              p-3 rounded-full transition-colors\n              ".concat(s?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white","\n            "),title:s?"Stop Sharing":"Share Screen",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>m(!u),className:"p-3 bg-gray-700 hover:bg-gray-600 rounded-full text-white transition-colors md:hidden",title:"More Options",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),u&&(0,r.jsx)("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-gray-700 rounded-lg shadow-lg overflow-hidden",children:p&&(0,r.jsxs)("button",{onClick:()=>{h(),m(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-gray-600 transition-colors flex items-center space-x-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,r.jsx)("span",{children:"Switch Camera"})]})})]}),p&&(0,r.jsx)("button",{onClick:h,className:"hidden md:block p-3 bg-gray-700 hover:bg-gray-600 rounded-full text-white transition-colors",title:"Switch Camera",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,r.jsx)("div",{className:"w-px h-8 bg-gray-600 mx-2"}),(0,r.jsxs)("button",{onClick:n,className:"px-6 py-3 bg-red-600 hover:bg-red-700 rounded-full text-white font-medium transition-colors flex items-center space-x-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Leave"})]})]})})})}function x(){let e=(0,a.useParams)(),t=(0,a.useSearchParams)(),n=(0,a.useRouter)(),i=e.roomId,s=t.get("pin"),c="true"===t.get("host"),[l,d]=(0,o.useState)(!0),[h,m]=(0,o.useState)(""),[p,x]=(0,o.useState)(null),[S,w]=(0,o.useState)(!1),[k,b]=(0,o.useState)(null),{participants:C,localParticipant:y,isConnecting:j,isConnected:E,connectionManager:N,error:L,initialize:I,disconnect:M}=g();(0,o.useEffect)(()=>{if(P(),c){let e=sessionStorage.getItem("hostPin_".concat(i));e&&b(e)}},[i,s,c]),(0,o.useEffect)(()=>{!p||E||j||N||(console.log("RoomPage: Starting conference initialization"),I(i,s,p.isHost).catch(e=>{console.error("Conference initialization failed:",e),m("Failed to join conference: ".concat(e.message))}))},[p,E,j,N]),(0,o.useEffect)(()=>()=>{M()},[]);let P=async()=>{if(!s){m("PIN is required"),d(!1);return}try{let e=await fetch((0,u.k)("/api/rooms/".concat(i,"/validate")),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pin:s})});if(!e.ok){let t=await e.json();throw Error(t.error||"Invalid room or PIN")}let t=await e.json();x(t),d(!1)}catch(e){console.error("Room validation failed:",e),m(e.message||"Failed to join room. Please check your PIN and try again."),d(!1)}},R=async()=>{if(!(null==p?void 0:p.participantPin))return;let e=window.location.origin,t="".concat(e,"/meet/room/").concat(i,"?pin=").concat(p.participantPin);try{await navigator.clipboard.writeText(t),w(!0),setTimeout(()=>w(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return l?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-12 w-12 text-blue-600 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Validating room access..."})]})}):h||L?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-center",children:[(0,r.jsx)("div",{className:"text-red-600 dark:text-red-400 mb-4",children:(0,r.jsx)("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:h?"Access Denied":"Connection Error"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:h||L}),(0,r.jsx)("button",{onClick:()=>n.push("/"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Home"})]})}):j?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-12 w-12 text-blue-600 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Connecting to conference..."})]})}):(0,r.jsx)("main",{className:"min-h-screen bg-gray-900",children:(0,r.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,r.jsxs)("div",{className:"bg-gray-800 px-4 py-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("h1",{className:"text-white font-semibold",children:["Room: ",i]}),(null==p?void 0:p.isHost)&&(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-600 text-white text-xs rounded",children:"HOST"})]}),(0,r.jsxs)("div",{className:"text-gray-400 text-sm",children:[C.size+1," participant(s)"]})]}),(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)(v,{localParticipant:y,participants:C})}),(0,r.jsx)(f,{onLeave:()=>{M(),n.push("/")}}),(null==p?void 0:p.isHost)&&(0,r.jsx)("div",{className:"bg-gray-700 px-4 py-3 border-t border-gray-600",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium",children:[(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),S?"Link Copied!":"Share Room Link"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,r.jsxs)("div",{className:"bg-gray-600 px-3 py-2 rounded",children:[(0,r.jsx)("p",{className:"text-gray-400 mb-1",children:"Room ID"}),(0,r.jsx)("p",{className:"font-mono text-white font-semibold",children:i})]}),(0,r.jsxs)("div",{className:"bg-gray-600 px-3 py-2 rounded",children:[(0,r.jsx)("p",{className:"text-gray-400 mb-1",children:"Participant PIN"}),(0,r.jsx)("p",{className:"font-mono text-white font-semibold",children:p.participantPin})]})]}),k&&(0,r.jsxs)("div",{className:"bg-blue-900/30 border border-blue-700 px-3 py-2 rounded",children:[(0,r.jsx)("p",{className:"text-blue-300 text-xs mb-1",children:"Your Host PIN (save this to rejoin)"}),(0,r.jsx)("p",{className:"font-mono text-blue-100 font-bold text-sm",children:k})]})]})})]})})}},4663:function(e,t,n){"use strict";function r(e){return window.location.pathname.startsWith("/meet")?"/meet".concat(e):e}n.d(t,{k:function(){return r}})}},function(e){e.O(0,[962,971,23,744],function(){return e(e.s=8339)}),_N_E=e.O()}]);